#include "crkbd.h"


#ifdef AUDIO_ENABLE
    float tone_startup[][2] = SONG(STARTUP_SOUND);
    float tone_goodbye[][2] = SONG(GOODBYE_SOUND);
#endif

#ifdef SSD1306OLED
void led_set_kb(uint8_t usb_led) {
    // put your keyboard LED indicator (ex: Caps Lock LED) toggling code here
    //led_set_user(usb_led);
}
#endif

#ifdef RGB_MATRIX_ENABLE
	// Left Hand Mapped in order of WS2812 array
  // 25 24 19 18 11 10
  // 26 23 20 17 12 09
  // 27 22 21 16 13 08
  //             15 14 07
  //
	// Right Hand Mapped in order of WS2812 array
  //     10 11 18 19 24 25
  //     09 12 17 20 23 26
  //     08 13 16 21 22 27
  //  07 14 15
  //
  // Columns
  // 0  1  2  3  4  5  6  7  8  9  10 11 12 13
  //                                              Rows
  // 25 24 19 18 11 10       10 11 18 19 24 25    0
  // 26 23 20 17 12 09       09 12 17 20 23 26    1
  // 27 22 21 16 13 08       08 13 16 21 22 27    2
  //          15 14 07       07 14 15             3

    /* {row | col << 4}
 *    |              {x=0..224, y=0..64}
 *    |                      |        modifier
 *    |                      |   |   */
#define RGB_MATRIX_LEFT  /* left hand leds */               \
   { { 0xFF           }, {          0,          0 }, 0 },   \
   { { 0xFF           }, {          0,          0 }, 0 },  \
   { { 0xFF           }, {          0,          0 }, 0 },  \
   { { 0xFF           }, {          0,          0 }, 0 },  \
   { { 0xFF           }, {          0,          0 }, 0 },  \
   { { 0xFF           }, {          0,          0 }, 0 },  \
 \
   { { 3 | ( 5 << 4 ) }, { 17.23 *  6, 21.33 *  3 }, 1 },  \
   { { 2 | ( 5 << 4 ) }, { 17.23 *  5, 21.33 *  2 }, 0 },  \
   { { 1 | ( 5 << 4 ) }, { 17.23 *  5, 21.33 *  1 }, 0 },  \
   { { 0 | ( 5 << 4 ) }, { 17.23 *  5, 21.33 *  0 }, 0 },  \
   { { 0 | ( 4 << 4 ) }, { 17.23 *  4, 21.33 *  0 }, 0 },  \
   { { 1 | ( 4 << 4 ) }, { 17.23 *  4, 21.33 *  1 }, 0 },  \
   { { 2 | ( 4 << 4 ) }, { 17.23 *  4, 21.33 *  2 }, 0 },  \
   { { 3 | ( 4 << 4 ) }, { 17.23 *  5, 21.33 *  3 }, 1 },  \
   { { 3 | ( 3 << 4 ) }, { 17.23 *  4, 21.33 *  3 }, 1 },  \
   { { 2 | ( 3 << 4 ) }, { 17.23 *  3, 21.33 *  2 }, 0 },  \
   { { 1 | ( 3 << 4 ) }, { 17.23 *  3, 21.33 *  1 }, 0 },  \
   { { 0 | ( 3 << 4 ) }, { 17.23 *  3, 21.33 *  0 }, 0 },  \
   { { 0 | ( 2 << 4 ) }, { 17.23 *  2, 21.33 *  0 }, 0 },  \
   { { 1 | ( 2 << 4 ) }, { 17.23 *  2, 21.33 *  1 }, 0 },  \
   { { 2 | ( 2 << 4 ) }, { 17.23 *  2, 21.33 *  2 }, 0 },  \
   { { 2 | ( 1 << 4 ) }, { 17.23 *  1, 21.33 *  2 }, 0 },  \
   { { 1 | ( 1 << 4 ) }, { 17.23 *  1, 21.33 *  1 }, 0 },  \
   { { 0 | ( 1 << 4 ) }, { 17.23 *  1, 21.33 *  0 }, 0 },  \
   { { 0 | ( 0 << 4 ) }, { 17.23 *  0, 21.33 *  0 }, 1 },  \
   { { 1 | ( 0 << 4 ) }, { 17.23 *  0, 21.33 *  1 }, 1 },  \
   { { 2 | ( 0 << 4 ) }, { 17.23 *  0, 21.33 *  2 }, 1 },

#define RGB_MATRIX_RIGHT  /* right hand leds */ \
   { { 0xFF           }, {          0,          0 }, 0 },  \
   { { 0xFF           }, {          0,          0 }, 0 },  \
   { { 0xFF           }, {          0,          0 }, 0 },  \
   { { 0xFF           }, {          0,          0 }, 0 },  \
   { { 0xFF           }, {          0,          0 }, 0 },  \
   { { 0xFF           }, {          0,          0 }, 0 },  \
 \
   { { 7 | ( 5 << 4 ) }, { 17.23 *  7, 21.33 *  3 }, 1 },  \
   { { 6 | ( 5 << 4 ) }, { 17.23 *  8, 21.33 *  2 }, 0 },  \
   { { 5 | ( 5 << 4 ) }, { 17.23 *  8, 21.33 *  1 }, 0 },  \
   { { 4 | ( 5 << 4 ) }, { 17.23 *  8, 21.33 *  0 }, 0 },  \
   { { 4 | ( 4 << 4 ) }, { 17.23 *  9, 21.33 *  0 }, 0 },  \
   { { 5 | ( 4 << 4 ) }, { 17.23 *  9, 21.33 *  1 }, 0 },  \
   { { 6 | ( 4 << 4 ) }, { 17.23 *  9, 21.33 *  2 }, 0 },  \
   { { 7 | ( 4 << 4 ) }, { 17.23 *  8, 21.33 *  3 }, 1 },  \
   { { 7 | ( 3 << 4 ) }, { 17.23 *  9, 21.33 *  3 }, 1 },  \
   { { 6 | ( 3 << 4 ) }, { 17.23 * 10, 21.33 *  2 }, 0 },  \
   { { 5 | ( 3 << 4 ) }, { 17.23 * 10, 21.33 *  1 }, 0 },  \
   { { 4 | ( 3 << 4 ) }, { 17.23 * 10, 21.33 *  0 }, 0 },  \
   { { 4 | ( 2 << 4 ) }, { 17.23 * 11, 21.33 *  0 }, 0 },  \
   { { 5 | ( 2 << 4 ) }, { 17.23 * 11, 21.33 *  1 }, 0 },  \
   { { 6 | ( 2 << 4 ) }, { 17.23 * 11, 21.33 *  2 }, 0 },  \
   { { 6 | ( 1 << 4 ) }, { 17.23 * 12, 21.33 *  2 }, 0 },  \
   { { 5 | ( 1 << 4 ) }, { 17.23 * 12, 21.33 *  1 }, 0 },  \
   { { 4 | ( 1 << 4 ) }, { 17.23 * 12, 21.33 *  0 }, 0 },  \
   { { 4 | ( 0 << 4 ) }, { 17.23 * 13, 21.33 *  0 }, 1 },  \
   { { 5 | ( 0 << 4 ) }, { 17.23 * 13, 21.33 *  1 }, 1 },  \
   { { 6 | ( 0 << 4 ) }, { 17.23 * 13, 21.33 *  2 }, 1 },

#ifdef RGB_MATRIX_SPLIT_RIGHT
const rgb_led g_rgb_leds[DRIVER_LED_TOTAL] = {
RGB_MATRIX_RIGHT
RGB_MATRIX_LEFT
  };
#else
const rgb_led g_rgb_leds[DRIVER_LED_TOTAL] = {
RGB_MATRIX_LEFT
RGB_MATRIX_RIGHT
  };
#endif
#endif

void matrix_init_kb(void) {

    #ifdef AUDIO_ENABLE
        _delay_ms(20); // gets rid of tick
        PLAY_SONG(tone_startup);
    #endif

	matrix_init_user();
};

void shutdown_kb(void) {
    #ifdef AUDIO_ENABLE
        PLAY_SONG(tone_goodbye);
      	_delay_ms(150);
      	stop_all_notes();
    #endif
}
